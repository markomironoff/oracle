##Oratab tiedosto kuntoon:

[root@oraclesrv ~]# vi /etc/oratab
orcl:/u01/app/oracle/product/19.0.0/db_1:Y
orcl2:/u01/app/oracle/product/19.0.0/db_1:Y

##Start ja Stop tiedostot:

[root@oraclesrv ~]# vi /usr/local/bin/start_oracle.sh
#!/bin/bash
#
# Oracle autostart 1.2 Marko Mironoff Fujitsu Finland 6.10.2025
#
export ORACLE_HOME=/u01/app/oracle/product/19.0.0/db_1
export PATH=$ORACLE_HOME/bin:$PATH
# waiting for network adapter binding, vaihda tähän palvelimen ip
IP=10.0.2.15
while  ! ip a | grep -q "$IP"; do
  echo "Waiting for IP $IP to become available..."
  sleep 2
done

$ORACLE_HOME/bin/lsnrctl start
#$ORACLE_HOME/bin/lsnrctl start LISTENER_ORCL2
$ORACLE_HOME/bin/dbstart $ORACLE_HOME



[root@oraclesrv ~]# vi /usr/local/bin/stop_oracle.sh
#!/bin/bash
#
# Oracle autostart 1.2 Marko Mironoff Fujitsu Finland 6.10.2025
#
export ORACLE_HOME=/u01/app/oracle/product/19.0.0/db_1
export PATH=$ORACLE_HOME/bin:$PATH
$ORACLE_HOME/bin/dbshut $ORACLE_HOME
$ORACLE_HOME/bin/lsnrctl stop
#$ORACLE_HOME/bin/lsnrctl stop LISTENER_ORCL2

##Oikeudet:

[root@oraclesrv ~]# chown oracle:oinstall /usr/local/bin/start_oracle.sh
[root@oraclesrv ~]# chmod 755 /usr/local/bin/start_oracle.sh
[root@oraclesrv ~]# chown oracle:oinstall /usr/local/bin/stop_oracle.sh
[root@oraclesrv ~]# chmod 755 /usr/local/bin/stop_oracle.sh

Huomioidaan SELinux, jos on enforcing niin systemd pystyy ajamaan sen ongelmitta:

[root@oraclesrv ~]# restorecon -v /usr/local/bin/start_oracle.sh
[root@oraclesrv ~]# restorecon -v /usr/local/bin/stop_oracle.sh

##Luodaan dbora.service:

[root@oraclesrv ~]# vi /etc/systemd/system/dbora.service
[Unit]
Description=Start and Stop Oracle Database and Listener
After=network.target

[Service]
Type=oneshot
User=oracle
Group=oinstall
ExecStart=/usr/local/bin/start_oracle.sh
ExecStop=/usr/local/bin/stop_oracle.sh
TimeoutSec=300
Restart=no
RemainAfterExit=true
StandardOutput=journal
StandardError=journal
[Install]
WantedBy=multi-user.target

## reload, enable
[root@oraclesrv ~]# systemctl daemon-reload
[root@oraclesrv ~]# systemctl enable dbora.service

## Hyödyllisiä komentoja:
[root@oraclesrv ~]# journalctl -u dbora
[root@oraclesrv ~]# systemctl status dbora.service
[root@oraclesrv ~]# systemctl start dbora.service
[root@oraclesrv ~]# systemctl stop dbora.service

## Esimerkkiympäristössä on ollut orcl ja orcl2 tietokannat samassa ORACLE_HOME:ssa
## orcl default listenerissä ja dedikoitu listener orcl2-kannalle
##
## [root@oraclesrv ~]# ps -ef | grep smon
## oracle      1778       1  0 06:07 ?        00:00:00 ora_smon_orcl2
## oracle      1964       1  0 06:07 ?        00:00:00 ora_smon_orcl
## root        2892    2597  0 07:35 pts/0    00:00:00 grep --color=auto smon
## [root@oraclesrv ~]# ps -ef | grep tnslsnr
## oracle       855       1  0 06:07 ?        00:00:00 /u01/app/oracle/product/19.0.0/db_1/bin/tnslsnr LISTENER -inherit
## oracle       867       1  0 06:07 ?        00:00:00 /u01/app/oracle/product/19.0.0/db_1/bin/tnslsnr LISTENER_ORCL2 -inherit
## root        2894    2597  0 07:35 pts/0    00:00:00 grep --color=auto tnslsnr
## 
## [oracle@oraclesrv admin]$ more listener.ora
## # listener.ora Network Configuration File: /u01/app/oracle/product/19.0.0/db_1/network/admin/listener.ora
## # Generated by Oracle configuration tools.
## 
## LISTENER =
##   (DESCRIPTION_LIST =
##     (DESCRIPTION =
##       (ADDRESS = (PROTOCOL = TCP)(HOST = oraclesrv)(PORT = 1521))
##       (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
##     )
##   )
## SID_LIST_LISTENER =
##   (SID_LIST =
##     (SID_DESC =
##       (SID_NAME = orcl)
##       (ORACLE_HOME = /u01/app/oracle/product/19.0.0/db_1)
##     )
##   )
## LISTENER_ORCL2 =
##   (DESCRIPTION_LIST =
##     (DESCRIPTION =
##       (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1522))
##     )
##   )
## 
## SID_LIST_LISTENER_ORCL2 =
##   (SID_LIST =
##     (SID_DESC =
##       (SID_NAME = orcl2)
##       (ORACLE_HOME = /u01/app/oracle/product/19.0.0/db_1)
##     )
##   )

CREATE OR REPLACE TRIGGER open_pdb1_on_startup
AFTER STARTUP ON DATABASE
BEGIN
   EXECUTE IMMEDIATE 'ALTER PLUGGABLE DATABASE PDB1 OPEN';
END;
/